<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kalkulator — Desain HTML</title>
  <style>
    :root{
      --bg:#0f1724;
      --panel:#0b1220;
      --accent:#7dd3fc;
      --accent-2:#60a5fa;
      --glass: rgba(255,255,255,0.04);
      --btn-size: 72px;
      --radius: 12px;
      --text:#e6eef8;
    }

    *{box-sizing:border-box}
    html,body{
      height:100%;
      margin:0;
      font-family: Inter, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background: linear-gradient(180deg,#071026 0%, #0b1220 100%);
      color:var(--text);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
    }

    .calculator {
      width: min(420px, 96vw);
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius: var(--radius);
      box-shadow: 0 8px 30px rgba(2,6,23,0.7), inset 0 1px 0 rgba(255,255,255,0.02);
      padding: 18px;
      border: 1px solid rgba(255,255,255,0.04);
    }

    .header {
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
      margin-bottom:8px;
    }

    .brand {
      display:flex;
      align-items:center;
      gap:10px;
    }
    .logo {
      width:36px; height:36px; border-radius:8px;
      background: linear-gradient(135deg,var(--accent),var(--accent-2));
      display:flex; align-items:center; justify-content:center;
      font-weight:700; color:#022; box-shadow: 0 4px 12px rgba(96,165,250,0.18);
    }
    .brand span { font-weight:600; font-size:16px; letter-spacing:0.2px; color:var(--text); }

    .mode {
      font-size:13px; color: rgba(230,238,248,0.7);
      background: var(--glass); padding:6px 10px; border-radius:999px;
    }

    .display {
      margin-top:6px;
      background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
      padding: 12px;
      border-radius:10px;
      min-height:86px;
      display:flex;
      flex-direction:column;
      justify-content:center;
      gap:6px;
      border:1px solid rgba(255,255,255,0.02);
    }

    .history {
      font-size:14px; color: rgba(230,238,248,0.6); text-align:right; word-break:break-all;
      min-height:18px;
    }
    .output {
      font-size:28px; font-weight:700; text-align:right; color:var(--text);
      word-break:break-all;
    }

    .keypad {
      margin-top:14px;
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap:10px;
      align-items:stretch;
    }

    button.key {
      height: var(--btn-size);
      border-radius:10px;
      border: none;
      background: linear-gradient(180deg, rgba(255,255,255,0.015), rgba(255,255,255,0.01));
      color: var(--text);
      font-size:20px;
      font-weight:600;
      cursor: pointer;
      box-shadow: 0 6px 18px rgba(2,6,23,0.65);
      transition: transform .08s ease, box-shadow .12s ease, background .12s ease;
      user-select:none;
    }
    button.key:active { transform: translateY(2px) scale(.998); }

    /* Special styles */
    .op { background: linear-gradient(180deg, rgba(96,165,250,0.12), rgba(125,211,252,0.06)); color: #eaf6ff; }
    .equals { grid-column: span 2; background: linear-gradient(135deg,var(--accent),var(--accent-2)); color:#022; font-size:20px; box-shadow: 0 10px 30px rgba(96,165,250,0.2); }
    .wide { grid-column: span 2; }
    .danger { background: linear-gradient(180deg, rgba(255,90,90,0.08), rgba(255,90,90,0.04)); color:#ffdfe0; }

    /* smaller screens */
    @media (max-width:420px){
      :root{ --btn-size:64px; }
      .output{ font-size:24px; }
    }
    /* accessibility focus */
    button.key:focus { outline: 2px solid rgba(125,211,252,0.18); outline-offset:2px; }
  </style>
</head>
<body>
  <main class="calculator" aria-label="Kalkulator sederhana">
    <div class="header">
      <div class="brand">
        <div class="logo">C</div>
        <span>Kalkulator</span>
      </div>
      <div class="mode" id="modeLabel">Standard</div>
    </div>

    <section class="display" aria-live="polite">
      <div class="history" id="history">&nbsp;</div>
      <div class="output" id="output">0</div>
    </section>

    <section class="keypad" role="toolbar" aria-label="Tombol kalkulator">
      <!-- Row 1 -->
      <button class="key danger" data-action="clear" title="Clear (C)">C</button>
      <button class="key" data-action="back" title="Backspace (⌫)">⌫</button>
      <button class="key" data-value="%" title="Persen">%</button>
      <button class="key op" data-value="/" title="Bagi">÷</button>

      <!-- Row 2 -->
      <button class="key" data-value="7">7</button>
      <button class="key" data-value="8">8</button>
      <button class="key" data-value="9">9</button>
      <button class="key op" data-value="*" title="Kali">×</button>

      <!-- Row 3 -->
      <button class="key" data-value="4">4</button>
      <button class="key" data-value="5">5</button>
      <button class="key" data-value="6">6</button>
      <button class="key op" data-value="-" title="Kurang">−</button>

      <!-- Row 4 -->
      <button class="key" data-value="1">1</button>
      <button class="key" data-value="2">2</button>
      <button class="key" data-value="3">3</button>
      <button class="key op" data-value="+" title="Tambah">+</button>

      <!-- Row 5 -->
      <button class="key" data-value="0">0</button>
      <button class="key" data-value="." title="Desimal">.</button>
      <button class="key wide equals" data-action="equals" title="Sama dengan">=</button>
    </section>
  </main>

  <script>
    (function(){
      const outputEl = document.getElementById('output');
      const historyEl = document.getElementById('history');
      const keys = document.querySelectorAll('button.key');

      let expr = '';       // expression shown to eval
      let lastResult = null;

      function updateView(){
        outputEl.textContent = expr === '' ? '0' : expr;
        historyEl.textContent = lastResult === null ? '' : String(lastResult);
      }

      function push(char){
        // Basic guards: prevent two operators in a row (except minus after open paren)
        const ops = ['+','-','*','/'];
        const last = expr.slice(-1);
        if (ops.includes(char)) {
          if (expr === '' && char !== '-') return; // don't start with +*/ 
          if (ops.includes(last) && !(char === '-' && last === '(')) {
            // replace last operator with new one
            expr = expr.slice(0,-1) + char;
            updateView(); return;
          }
        }
        expr += char;
        updateView();
      }

      function clearAll(){
        expr = '';
        lastResult = null;
        updateView();
      }

      function backspace(){
        expr = expr.slice(0,-1);
        updateView();
      }

      function sanitize(s){
        // allow digits, operators, parentheses, dot, percent, and spaces
        const ok = /^[0-9+\-*/().%\s]+$/;
        return ok.test(s);
      }

      function evalExpression(s){
        if (!sanitize(s)) throw new Error('Invalid characters');
        // convert percent sign to division by 100
        // e.g. "50%" -> "(50/100)"; "5+10%" -> "5+(10/100)"
        // simple approach: replace every occurrence of number% with (number/100)
        s = s.replace(/(\d+(\.\d+)?)%/g, '($1/100)');
        // replace unicode ÷ and × if present
        s = s.replace(/÷/g, '/').replace(/×/g, '*').replace(/−/g, '-');

        // use Function as a safer eval wrapper
        // still keep try/catch to handle runtime errors (e.g., division by zero)
        const fn = new Function('return (' + s + ')');
        return fn();
      }

      function compute(){
        if (expr.trim() === '') return;
        try {
          const res = evalExpression(expr);
          if (!isFinite(res)) throw new Error('Math error');
          lastResult = res;
          expr = String(res);
          updateView();
        } catch (err) {
          outputEl.textContent = 'Error';
          expr = '';
          lastResult = null;
        }
      }

      // attach click handlers
      keys.forEach(btn => {
        const val = btn.dataset.value;
        const action = btn.dataset.action;

        btn.addEventListener('click', () => {
          if (action === 'clear') { clearAll(); return; }
          if (action === 'back') { backspace(); return; }
          if (action === 'equals') { compute(); return; }
          if (val) push(val);
        });
      });

      // keyboard support
      window.addEventListener('keydown', (e) => {
        const key = e.key;
        if ((/^[0-9]$/).test(key)) { push(key); e.preventDefault(); return; }
        if (key === '.') { push('.'); e.preventDefault(); return; }
        if (key === 'Enter' || key === '=') { compute(); e.preventDefault(); return; }
        if (key === 'Backspace') { backspace(); e.preventDefault(); return; }
        if (key === 'Escape') { clearAll(); e.preventDefault(); return; }
        if (['+','-','*','/','(',')','%'].includes(key)) { push(key); e.preventDefault(); return; }
      });

      // initialize
      updateView();
    })();
  </script>
</body>
</html>